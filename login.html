<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login | MyPharmAlly</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<nav>
  <ul class="navbar" id="navbar-menu">
    <li><a href="index.html">Home</a></li>
    <li><a href="buy-medicines.html">Buy Medicines</a></li>
    <li id="nav-login"><a href="login.html" aria-current="page">Login</a></li>
    <li id="nav-signup"><a href="signup.html">Sign Up</a></li>
    <li class="profile-li" id="nav-profile" style="display:none;">
      <a href="profile.html">
        <img src="images/profile-icon.png" alt="My Profile" class="profile-icon" title="My Profile" />
      </a>
    </li>
    <li id="nav-logout" style="display:none;"><a href="#" onclick="logoutUser(event)">Log Out</a></li>
  </ul>
</nav>

<main class="container">
  <h1>Login to MyPharmAlly</h1>

  <form id="loginForm" novalidate>
    <label for="email">Email</label>
    <input type="email" id="email" required />

    <label for="password">Password</label>
    <input type="password" id="password" required />

    <button type="submit" class="btn">Login</button>
  </form>
</main>

<footer>
  <p>Â© 2025 MyPharmAlly. All rights reserved.</p>
</footer>

<!-- Toast -->
<div id="toast" class="toast">...</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBpTbJB6FuxDjrXKmWEzl1WZR9MPvchTbc",
    authDomain: "mypharmally-b87c5.firebaseapp.com",
    projectId: "mypharmally-b87c5",
    storageBucket: "mypharmally-b87c5.appspot.com",
    messagingSenderId: "302027821610",
    appId: "1:302027821610:web:9f2e5eb74d7b5d79e0e953"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  const toast = document.getElementById("toast");

  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 3000);
  }

  document.getElementById("loginForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    if (!email || !password) {
      showToast("Please fill in all fields.");
      return;
    }

    auth.signInWithEmailAndPassword(email, password)
      .then((userCredential) => {
        showToast("Login successful!");
        localStorage.setItem("loggedIn", "true");
        setTimeout(() => window.location.href = "profile.html", 1200);
      })
      .catch((error) => {
        showToast("Invalid email or password.");
      });
  });

  function logoutUser(e) {
    e.preventDefault();
    auth.signOut().then(() => {
      localStorage.removeItem("loggedIn");
      updateNavbar();
      window.location.href = "index.html";
    });
  }

  function updateNavbar() {
    const loggedIn = localStorage.getItem("loggedIn") === "true";
    document.getElementById("nav-login").style.display = loggedIn ? "none" : "inline-block";
    document.getElementById("nav-signup").style.display = loggedIn ? "none" : "inline-block";
    document.getElementById("nav-profile").style.display = loggedIn ? "flex" : "none";
    document.getElementById("nav-logout").style.display = loggedIn ? "inline-block" : "none";
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      localStorage.setItem("loggedIn", "true");
    } else {
      localStorage.removeItem("loggedIn");
    }
    updateNavbar();
  });

  updateNavbar();
</script>

<style>
  #toast {
    visibility: hidden;
    min-width: 250px;
    margin-left: -125px;
    background-color: #26a69a;
    color: white;
    text-align: center;
    border-radius: 8px;
    padding: 14px;
    position: fixed;
    z-index: 9999;
    left: 50%;
    bottom: 30px;
    font-weight: bold;
    font-size: 1rem;
    opacity: 0;
    transition: visibility 0s, opacity 0.5s ease-in-out;
  }

  #toast.show {
    visibility: visible;
    opacity: 1;
  }
</style>

</body>
</html>
